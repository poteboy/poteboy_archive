{"componentChunkName":"component---src-components-post-tsx","path":"/tech/gatsby-seo","result":{"data":{"contentfulTech":{"title":"【Gatsby】サイトマップやメタタグを設置してSEO対策する","publishedDate":"May 2nd, 2021","description":"Gatsby製のサイトのメタタグのページ毎の設定方法やサイトマップ設置方法の解説","body":{"childMarkdownRemark":{"html":"<h2>GatsbyでSEO対策</h2>\n<p>検索エンジンに評価されるためには、metaタグを設置したり、サイトマップを作成する事が重要である。<code class=\"language-text\">gatsby-plugin-sitemap</code>や<code class=\"language-text\">gatsby-plugin-react-helmet</code>などのプラグインを用いればGatsbyで簡単にSEO対策する事ができる。</p>\n<br/>\n<h2>サイトマップを設置</h2>\n<h3>プラグインのインストール</h3>\n<br/>\n<p><code class=\"language-text\">gatsby-plugin-sitemap</code>というプラグインをインストールする</p>\n<br/>\n<div class=\"gatsby-code-title your-custom-class-name\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> gatsby-plugin-sitemap</code></pre></div>\n<br/>\n<h3>gatsby-config.jsを編集</h3>\n<p>先ほどインストールしたプラグインを有効化するために、gatsby-config.jsファイルを以下のように編集する。</p>\n<p><code class=\"language-text\">siteUrl</code>には、デプロイ先のURLを入力する</p>\n<br/>\n<div class=\"gatsby-code-title your-custom-class-name\">gatsby-config.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  siteMetadata<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    siteUrl<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">デプロイ先のURL</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-plugin-sitemap</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>以上で設定は完了したので、<code class=\"language-text\">build</code>後に<code class=\"language-text\">デプロイ先のURL/sitemap.xml</code>に移動すれば確認する事ができる。</p>\n<p>なお、developmentモードでは上記は確認する事ができないので、プラグインのインストールとgatsby-config.jsの編集が終わった後に、<code class=\"language-text\">gatsby build &amp;&amp; serve</code>をする必要がある。</p>\n<br/>\n<h3>v4での注意点</h3>\n<br/>\n<p>現在公開されている<code class=\"language-text\">gatsby-plugin-sitemap</code>のバージョン(v4.0.0)では、<code class=\"language-text\">https://○○○.com/sitemap.xml</code>に移動してもサイトマップを確認する事ができない。</p>\n<p><a href=\"https://github.com/gatsbyjs/gatsby/issues/31095\">GitHub上のissue</a>によると、現在サイトマップは<code class=\"language-text\">https://○○○.com/sitemap/sitemap-0.xml</code>に設置されているので、最新版のプラグインをインストールする際は注意が必要である。</p>\n<br/>\n<h2>メタタグの設定</h2>\n<br/>\n<p>メタタグは<code class=\"language-text\">&lt;head&gt;</code>タグ内に設定されるタグで、各ページのタイトルや説明文を追加する。Gatsbyでメタタグを設定するには、<code class=\"language-text\">react-helmet</code>というプラグインをインストールする必要がある。</p>\n<br/>\n<h3>プラグインのインストール</h3>\n<br/>\n<p><code class=\"language-text\">gatsby-plugin-react-helmet</code>と<code class=\"language-text\">react-helmet</code>という2つのプラグインをインストールする</p>\n<br/>\n<div class=\"gatsby-code-title your-custom-class-name\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> gatsby-plugin-react-helmet react-helmet</code></pre></div>\n<br/>\n<h3>gatsby-config.jsを編集</h3>\n<br/>\n<p>gatsby-config.jsに、以下を追加する。なお、○○○には任意の値を入れる。</p>\n<br/>\n<div class=\"gatsby-code-title your-custom-class-name\">gatsby-config.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  siteMetadata<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    title<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">○○○</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    description<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">○○○</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    author<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">○○○</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    siteUrl<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://○○○.com</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-plugin-react-helmet</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<h3>SEOコンポーネントの作成</h3>\n<br/>\n<p>手順としては、まず初めに、<code class=\"language-text\">components</code>配下に、<code class=\"language-text\">seo.tsx</code>を作成する。</p>\n<p>そして、GraphQLからgatsby-config.jsのsiteMetadataを取得する。</p>\n<p>最後に、<code class=\"language-text\">&lt;Helmet&gt;</code>タグ内に取得したsiteMetadataの情報を入力する。</p>\n<p>例としては、以下のように書く。</p>\n<br/>\n<div class=\"gatsby-code-title your-custom-class-name\">seo.tsx</div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">\"prop-types\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Helmet <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-helmet\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useStaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SEO</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">const</span> siteMetadata <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    query {\n        site {\n            siteMetadata {\n                title\n                description\n        }\n      }\n    }    \n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>siteMetadata\n\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>Helmet<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>meta property<span class=\"token operator\">=</span><span class=\"token string\">\"og:title\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>siteMetadata<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>meta property<span class=\"token operator\">=</span><span class=\"token string\">\"og:description\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>siteMetadata<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Helmet<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token constant\">SEO</span></code></pre></div>\n<br/>\n<p>これで、デフォルトでのメタタグの設定は終了。</p>\n<br/>\n<h3>各ページ個別のメタデータを設定する</h3>\n<br/>\n<p>上記の作業でメタデータの設定は出来たが、このままでは各ページ毎に固有のメタタグを設定する事はできていない。</p>\n<p>よって、作成したSEOコンポーネントでpropsを受け取るように書き換える必要がある。</p>\n<p>また、propsから値を受け取らなかった場合は先ほど同様にgatsby-config.jsにデフォルトの情報を使うようにする。</p>\n<br/>\n<div class=\"gatsby-code-title your-custom-class-name\">seo.tsx</div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SEO</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> seoProps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token operator\">**</span><span class=\"token operator\">*</span> 略 <span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n\n    <span class=\"token keyword\">const</span> seo <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        title<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>title <span class=\"token operator\">||</span> siteMetadata<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n        description<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>description <span class=\"token operator\">||</span> siteMetadata<span class=\"token punctuation\">.</span>description\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>Helmet<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>meta property<span class=\"token operator\">=</span><span class=\"token string\">\"og:title\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>seo<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>meta property<span class=\"token operator\">=</span><span class=\"token string\">\"og:description\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>seo<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Helmet<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">seoProps</span> <span class=\"token punctuation\">{</span>\n    title<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    description<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<br/>\n<p>後は、各ページコンポーネントに作成したSEOを埋め込み、propsを渡せば良い。</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">SEO</span>\n  title<span class=\"token operator\">=</span><span class=\"token string\">\"○○○\"</span>\n  description<span class=\"token operator\">=</span><span class=\"token string\">\"○○○\"</span>\n<span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<h2>参考</h2>\n<ul>\n<li><a href=\"https://www.gatsbyjs.com/docs/add-page-metadata/\">Adding Page Metadata</a></li>\n<li><a href=\"https://qiita.com/atomyah/items/2624ea4f9394e4a992b8#%E5%90%84%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%ABseo-%E3%82%92%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80\">Gatsby: SEO対策（Twitterカードなどmetaタグ設置）</a></li>\n</ul>"}}},"contentfulPoem":null},"pageContext":{"slug":"gatsby-seo"}},"staticQueryHashes":["2463962953","3000541721","3159585216"]}